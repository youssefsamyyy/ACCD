!function(){"use strict";var e={addClass:function(e,t){var n=e.className,i=n+(""!==n?" ":"")+t;e.className=i},removeClass:function(e,t){var n=" "+e.className+" ",i=(n=n.replace(/(\s+)/gi," ")).replace(" "+t+" "," ");i=i.replace(/(^\s+)|(\s+$)/g,""),e.className=i},hasClass:function(e,t){var n=e.className.split(/\s+/),i=0;for(i in n)if(n[i]==t)return!0;return!1},addEvent:function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n},removeEvent:function(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent?e.detachEvent("on"+t,n):delete e["on"+t]},removeElement:function(e){e&&e.parentNode&&e.parentNode.removeChild(e)},setUid:function(e){do{e+=Math.floor(1e6*Math.random())}while(document.getElementById(e));return e},clone:function(t){if("object"!=typeof t)return t;if(null===t)return t;var n={};for(var i in t)n[i]=e.clone(t[i]);return n},extend:function(){var e=arguments;if(!(e.length<1)){for(var t=this.clone(e[0]),n=1;n<e.length;n++)for(var i in e[n])t[i]=e[n][i];return t}},eventHandler:function(e){var t=e||window.event;return{ev:t,target:t.target||t.srcElement}},stopPropagation:function(e){e.stopPropagation?e.stopPropagation():window.event&&(window.event.cancelBubble=!0)},getOffset:function(e){var t=e.getBoundingClientRect();return{top:t.top+window.pageYOffset-document.documentElement.clientTop,left:t.left+window.pageXOffset-document.documentElement.clientLeft}}},t=function(n,i){if(!(this instanceof t))return new t(n,i);this.settings=e.extend({},this.defaults,i),this.el=n,this.multiple=!1,this.selected=[],this.shown=!1,this.disabled=!1,this.ul=null,this.optionLi=[],this.items=null,this.options=null,this.template='<div class="selecty"><a class="selecty-selected"></a><ul class="selecty-options"></ul></div>',this.init(n)};t.prototype={defaults:{separator:", ",placeholder:"Any"},init:function(e){"string"==typeof e&&"#"===e[0]&&(e=document.getElementById(e.substr(1)),this.el=e),e?e.length<1?console.error("No options inside <select>"):(null!==this.el.getAttributeNode("multiple")&&(this.multiple=!0),"SELECT"===e.nodeName&&this.build()):console.error("Need select element!")},build:function(){this.el.style.display="none",this.options=this.el.querySelectorAll("option"),this.items=this.el.querySelectorAll("option, optgroup"),null!==this.el.getAttributeNode("disabled")&&(this.disabled=!0);var t=document.createElement("div");t.innerHTML=this.template;var n=t.querySelector(".selecty");this.disabled&&e.addClass(n,"disabled"),this.btn=t.querySelector(".selecty-selected"),this.ul=t.querySelector(".selecty-options");for(var i=-1,s=!1,l=0;l<this.items.length;l++){i++;var o=document.createElement("li");"OPTGROUP"===this.items[l].nodeName?(i--,s=!0,o.innerHTML=this.items[l].getAttribute("label"),e.addClass(o,"optgroup")):(o.innerHTML=this.items[l].innerHTML,o.setAttribute("data-value",this.items[l].value),o.setAttribute("data-index",i),s&&e.addClass(o,"optgroup-option"),(null!==this.items[l].getAttributeNode("selected")||$(this.items[l]).is(":selected"))&&(this.selected.push(i),e.addClass(o,"selected")),null!==this.items[l].getAttributeNode("disabled")&&e.addClass(o,"disabled")),this.ul.appendChild(o)}this.optionLi=this.ul.querySelectorAll("li[data-index]"),this.updateSelected(),this.el.parentNode.insertBefore(t.firstChild,this.el.nextSibling),this.events()},events:function(){if(!this.disabled){var t=this;e.addEvent(t.btn,"click",function(i){var s=t.otherActived();null!==s&&e.removeClass(s,"active"),e.stopPropagation(i),t.show(),e.addEvent(document,"click",n)}),e.addEvent(document,"keydown",function(e){27==e.which&&t.hide()});var n=function(i){var s=e.eventHandler(i).target,l=parseInt(s.getAttribute("data-index"));if(!e.hasClass(s,"optgroup"))if("LI"===s.nodeName&&null!==l){if(e.hasClass(s,"disabled"))return;t.multiple?(e.hasClass(s,"selected")?t.selected.splice(t.selected.indexOf(l),1):t.selected.push(l),t.updateSelected()):(t.selected=[],t.selected.push(l),t.updateSelected(),t.hide(),e.removeEvent(document,"click",n))}else t.hide(),e.removeEvent(document,"click",n)}}},show:function(){e.addClass(this.ul,"active"),this.shown=!0},hide:function(){e.removeClass(this.ul,"active"),e.removeEvent(document.body,"click",function(e){}),this.shown=!1},otherActived:function(){for(var t=document.body.querySelectorAll(".selecty-options"),n=0;n<t.length;n++)if(e.hasClass(t[n],"active"))return t[n];return null},updateSelected:function(){this.clearSelected(),this.btn.innerHTML="",this.selected.sort(function(e,t){return e-t});for(var t=0;t<this.selected.length;t++){var n=this.selected[t];if(this.options[n].setAttribute("selected","selected"),$(this.options[n]).prop("selected",!0),e.addClass(this.optionLi[n],"selected"),this.multiple){var i=this.settings.separator;""===this.btn.innerHTML&&(i=""),this.btn.innerHTML+=i+this.options[n].innerHTML}else this.btn.innerHTML=this.options[n].innerHTML}""===this.btn.innerHTML&&(this.btn.innerHTML=this.settings.placeholder)},clearSelected:function(){for(var t=0;t<this.options.length;t++)this.options[t].removeAttribute("selected"),$(this.options[t]).prop("selected",!1),e.removeClass(this.optionLi[t],"selected")}},"undefined"!=typeof module&&module&&module.exports?module.exports=t:"function"==typeof define&&define.amd?define([],function(){return t}):window.selecty=t;var n=window.jQuery;void 0!==n&&(n.fn.selecty=function(){var e=Array.prototype.slice.call(arguments);return n(this).each(function(){e[0]&&"object"!=typeof e[0]?"string"==typeof e[0]&&t.prototype[e[0]].apply(new t(this),e.slice(1)):new t(this,e[0]||{})})})}();